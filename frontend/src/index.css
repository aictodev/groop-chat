@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --radius: 0.75rem;

  --background: 210 31% 94%;
  --foreground: 204 43% 13%;
  --card: 0 0% 100%;
  --card-foreground: 204 43% 13%;
  --popover: 0 0% 100%;
  --popover-foreground: 204 43% 13%;
  --primary: 167 100% 33%;
  --primary-foreground: 0 0% 100%;
  --secondary: 180 20% 93%;
  --secondary-foreground: 204 43% 13%;
  --muted: 180 14% 87%;
  --muted-foreground: 206 25% 46%;
  --accent: 197 100% 90%;
  --accent-foreground: 204 43% 13%;
  --destructive: 0 85% 60%;
  --destructive-foreground: 0 0% 100%;
  --border: 200 16% 84%;
  --input: 0 0% 100%;
  --ring: 167 100% 33%;

  --whatsapp-surface: #f0f2f5;
  --whatsapp-surface-alt: #f7f8fa;
  --whatsapp-panel: #ffffff;
  --whatsapp-panel-muted: #f5f6f6;
  --whatsapp-border: #d1d7db;
  --whatsapp-divider: #e9edef;
  --whatsapp-accent: #00a884;
  --whatsapp-accent-dark: #008069;
  --whatsapp-accent-soft: #d9fdd3;
  --whatsapp-accent-faded: #edf8f5;
  --whatsapp-ink: #111b21;
  --whatsapp-ink-soft: #667781;
  --whatsapp-ink-subtle: #8696a0;
  --whatsapp-bubble-incoming: #ffffff;
  --whatsapp-bubble-outgoing: #d9fdd3;
  --whatsapp-bubble-system: #e1f3ff;
  --whatsapp-bubble-meta: #667781;
}

.dark {
  --background: 204 43% 13%;
  --foreground: 210 40% 96%;
  --card: 204 43% 13%;
  --card-foreground: 210 40% 96%;
  --popover: 204 43% 13%;
  --popover-foreground: 210 40% 96%;
  --primary: 167 100% 33%;
  --primary-foreground: 210 40% 96%;
  --secondary: 210 22% 24%;
  --secondary-foreground: 210 40% 96%;
  --muted: 210 22% 24%;
  --muted-foreground: 214 30% 74%;
  --accent: 210 22% 24%;
  --accent-foreground: 210 40% 96%;
  --destructive: 0 63% 48%;
  --destructive-foreground: 210 40% 96%;
  --border: 213 28% 30%;
  --input: 213 28% 30%;
  --ring: 167 100% 33%;
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }

  html,
  body,
  #root {
    height: 100%;
    width: 100%;
    overflow: hidden;
    margin: 0;
    padding: 0;
  }

  body {
    @apply font-body antialiased;
    background-color: var(--whatsapp-surface);
    color: var(--whatsapp-ink);
    touch-action: manipulation;
    /* Removed fixed position to allow natural viewport behavior */
  }
}

@layer components {
  .landing-shell {
    @apply flex min-h-screen text-white;
    background: radial-gradient(circle at top left, rgba(111, 78, 235, 0.25) 0%, rgba(14, 6, 40, 0.8) 45%, rgba(2, 0, 12, 0.95) 100%);
  }

  .landing-hero {
    @apply flex-1 relative flex items-center justify-center overflow-hidden;
    background: linear-gradient(145deg, #090221 0%, #030014 60%, #02000d 100%);
  }

  .landing-hero__inner {
    @apply mx-auto flex max-w-xl flex-col gap-8 px-12 text-left;
  }

  .landing-brand {
    @apply text-sm font-semibold uppercase tracking-[0.4em] text-purple-200;
  }

  .landing-headline {
    @apply flex flex-col gap-4 text-4xl font-bold leading-tight text-purple-100 md:text-5xl;
  }

  .landing-headline__accent {
    @apply text-5xl text-purple-300 md:text-6xl;
  }

  .landing-headline__text {
    @apply text-3xl font-light text-purple-200 md:text-4xl;
  }

  .landing-subcopy {
    @apply text-base leading-relaxed text-purple-200/80 md:text-lg;
    max-width: 32rem;
  }

  .landing-panel {
    @apply flex min-h-screen w-full max-w-xl flex-1 items-center justify-center bg-black px-10 text-white;
  }

  .landing-panel__content {
    @apply flex w-full max-w-sm flex-col items-center gap-8 text-center;
  }

  .landing-panel__title {
    @apply text-3xl font-semibold text-white;
  }

  .landing-panel__subtitle {
    @apply text-sm text-neutral-400;
  }

  .landing-form {
    @apply w-full space-y-5 rounded-3xl border border-white/10 bg-white/5 p-6 shadow-landing backdrop-blur;
  }

  .landing-tabs {
    @apply flex items-center justify-center gap-2 rounded-full bg-white/10 p-1;
  }

  .landing-tab {
    @apply w-1/2 rounded-full px-4 py-2 text-sm font-medium text-neutral-300 transition;
  }

  .landing-tab--active {
    @apply bg-white text-black shadow;
  }

  .landing-fields {
    @apply space-y-4 text-left;
  }

  .landing-field {
    @apply flex flex-col gap-2 text-xs uppercase tracking-wide text-neutral-400;
  }

  .landing-field input {
    @apply rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-base font-medium text-white placeholder:text-neutral-500 focus:border-white/40 focus:outline-none;
  }

  .landing-submit {
    @apply w-full rounded-full bg-white py-3 text-sm font-semibold text-black transition hover:bg-neutral-100 disabled:cursor-not-allowed disabled:bg-white/60 disabled:text-neutral-400;
  }

  .landing-error {
    @apply rounded-xl border border-red-500/60 bg-red-500/10 px-4 py-2 text-xs font-medium text-red-200;
  }

  .landing-divider {
    @apply relative flex w-full items-center justify-center text-xs uppercase tracking-[0.4em] text-neutral-500;
  }

  .landing-divider::before,
  .landing-divider::after {
    content: "";
    @apply h-px flex-1 bg-white/10;
  }

  .landing-divider span {
    @apply px-4;
  }

  .landing-google-btn {
    @apply mt-2 flex w-full items-center justify-center gap-3 rounded-full bg-blue-500 px-6 py-5 text-base font-semibold text-white transition hover:bg-blue-400 focus-visible:ring-2 focus-visible:ring-blue-200;
  }

  .landing-google-btn__icon {
    @apply h-5 w-5;
  }

  .landing-links {
    @apply flex items-center gap-3 text-xs text-neutral-500;
  }

  .landing-link {
    @apply transition hover:text-neutral-300;
  }

  @screen lg {
    .landing-shell {
      @apply flex-row;
    }
  }

  @media (max-width: 1023px) {
    .landing-shell {
      @apply flex-col;
    }

    .landing-panel {
      @apply max-w-none py-16;
    }
  }

  .chat-shell {
    @apply flex w-full bg-whatsapp-surface text-whatsapp-ink overflow-hidden fixed top-0 left-0;
    height: 100dvh;
    /* Fallback */
    height: var(--app-height, 100dvh);
  }

  .chat-sidebar {
    @apply hidden lg:flex flex-col border-r border-whatsapp-border bg-whatsapp-surface overflow-hidden;
    width: var(--chat-sidebar-width, 360px);
  }

  .chat-sidebar__header {
    @apply flex items-center justify-between px-5 pt-6 pb-4;
  }

  .chat-sidebar__profile {
    @apply flex items-center gap-3;
  }

  .chat-sidebar__title {
    @apply text-base font-semibold text-whatsapp-ink;
  }

  .chat-sidebar__subtitle {
    @apply text-xs font-medium text-whatsapp-ink-soft;
  }

  .chat-sidebar__actions {
    @apply flex items-center gap-2;
  }

  .chat-sidebar__search {
    @apply px-5 pb-4;
  }

  .chat-sidebar__list {
    @apply flex-1 overflow-y-auto overflow-x-hidden px-3 pb-6 space-y-2;
  }

  .chat-sidebar__item {
    display: flex;
    gap: 0.75rem;
    width: 100%;
    align-items: flex-start;
    border-radius: 20px;
    border: 1px solid transparent;
    background: transparent;
    padding: 0.75rem 1rem;
    transition: all 150ms ease-out;
    cursor: pointer;
    text-align: left;
  }

  .chat-sidebar__item:hover {
    background-color: var(--whatsapp-panel);
  }

  .chat-sidebar__item--active {
    border-color: var(--whatsapp-divider);
    background-color: var(--whatsapp-panel);
    box-shadow: 0 12px 24px rgba(17, 27, 33, 0.08);
  }

  .chat-sidebar__avatar {
    @apply shrink-0;
  }

  .chat-sidebar__meta {
    @apply flex-1 min-w-0;
  }

  .chat-sidebar__meta-title {
    @apply text-sm font-medium text-whatsapp-ink truncate cursor-text;
  }

  .chat-sidebar__title-row {
    @apply flex items-center gap-1;
  }

  .chat-sidebar__title-button {
    @apply inline-flex w-full items-center gap-1 text-left;
    background: transparent;
    border: none;
    padding: 0;
    cursor: text;
  }

  .chat-sidebar__title-button:focus-visible {
    outline: none;
    border-radius: 0.5rem;
    box-shadow: 0 0 0 2px rgba(0, 168, 132, 0.35);
  }

  .chat-sidebar__title-icon {
    @apply h-3.5 w-3.5 text-whatsapp-ink-subtle;
    opacity: 0;
    transition: opacity 150ms ease;
  }

  .chat-sidebar__item:hover .chat-sidebar__title-icon,
  .chat-sidebar__item--active .chat-sidebar__title-icon {
    opacity: 0.85;
  }

  .chat-sidebar__meta-last {
    @apply mt-1 text-xs text-whatsapp-ink-soft truncate;
  }

  .chat-sidebar__rename-input {
    @apply w-full rounded-xl border border-whatsapp-divider bg-white px-3 py-2 text-sm font-medium text-whatsapp-ink shadow-sm focus:border-whatsapp-accent focus:outline-none;
  }

  .chat-sidebar__item--renaming {
    cursor: text;
  }

  .chat-sidebar__time {
    @apply text-xs text-whatsapp-ink-subtle whitespace-nowrap;
  }

  .chat-sidebar__item-actions {
    @apply flex flex-col items-end gap-2 ml-2;
  }

  .chat-sidebar__menu-btn {
    @apply flex h-8 w-8 items-center justify-center rounded-full text-whatsapp-ink-subtle transition hover:bg-white/70 hover:text-whatsapp-ink focus:outline-none;
  }

  .chat-header__menu-button {
    @apply flex h-10 w-10 items-center justify-center rounded-full text-whatsapp-ink-subtle transition hover:bg-white/70 hover:text-whatsapp-ink focus:outline-none;
  }

  .chat-sidebar__close-btn {
    @apply flex h-9 w-9 items-center justify-center rounded-full text-whatsapp-ink-subtle transition hover:bg-white/70 hover:text-whatsapp-ink focus:outline-none;
  }

  .chat-sidebar__overlay {
    @apply fixed inset-0 z-30 bg-black/40 backdrop-blur-sm;
  }

  @media (max-width: 1023px) {
    .chat-shell {
      @apply flex-col;
    }

    .chat-main {
      @apply h-full;
    }

    .chat-sidebar--mobile-open {
      @apply fixed inset-0 z-40 flex w-full flex-col bg-whatsapp-surface;
    }

    .chat-sidebar--mobile-open .chat-sidebar__list {
      @apply flex-1;
    }
  }

  .chat-main {
    @apply relative flex flex-1 flex-col bg-whatsapp-panel;
  }

  .chat-main::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-image: var(--chat-pattern);
    opacity: 0.4;
  }

  .chat-main__layer {
    @apply relative flex h-full flex-col;
  }

  .chat-header {
    @apply flex items-center justify-between gap-4 border-b border-whatsapp-divider bg-whatsapp-panel px-6 py-4 shadow-sm backdrop-blur;
    background-color: rgba(255, 255, 255, 0.95);
  }

  .chat-header__info {
    @apply flex items-center gap-3 min-w-0 flex-1;
  }

  .chat-header__title {
    @apply text-base font-semibold text-whatsapp-ink truncate;
  }

  .chat-header__title-button {
    background: transparent;
    border: none;
    padding: 0;
    cursor: text;
  }

  .chat-header__title-button:disabled {
    cursor: default;
  }

  .chat-header__title-button:focus-visible {
    outline: none;
    border-radius: 0.5rem;
    box-shadow: 0 0 0 2px rgba(0, 168, 132, 0.35);
  }

  .chat-header__status {
    @apply text-xs font-medium text-whatsapp-ink-soft truncate;
  }

  .chat-header__title-block {
    @apply flex flex-col gap-1 min-w-0 overflow-hidden w-full;
  }

  .chat-header__title-row {
    @apply flex items-center gap-2;
  }

  .chat-header__rename-input {
    @apply w-full min-w-0 rounded-xl border border-whatsapp-divider bg-white px-3 py-1 text-base font-semibold text-whatsapp-ink focus:border-whatsapp-accent focus:outline-none;
  }

  .chat-header__rename-button {
    @apply inline-flex items-center gap-1 rounded-full border border-whatsapp-divider px-2.5 py-1 text-xs font-semibold text-whatsapp-ink-soft transition hover:bg-white hover:text-whatsapp-ink;
  }



  .chat-header__rename {
    @apply ml-2 rounded-full border border-whatsapp-divider px-3 py-1 text-xs font-semibold text-whatsapp-ink-soft transition hover:bg-white hover:text-whatsapp-ink;
  }

  .chat-history {
    @apply flex-1 overflow-y-auto px-4 py-6;
    padding-bottom: clamp(6rem, 12vh, 8rem);
  }

  .chat-history__stack {
    @apply mx-auto flex w-full max-w-3xl flex-col gap-3;
  }

  .chat-message {
    @apply relative max-w-[78%] rounded-bubble px-4 py-3 text-[0.95rem] leading-relaxed shadow-bubble;
  }

  .chat-message--incoming {
    @apply bg-whatsapp-bubble-incoming text-whatsapp-ink;
  }

  .chat-message--outgoing {
    @apply ml-auto bg-whatsapp-bubble-outgoing text-whatsapp-ink;
  }

  .chat-message--system {
    @apply mx-auto max-w-[60%] rounded-lg border border-whatsapp-divider bg-white text-center text-xs font-medium text-whatsapp-ink-soft;
  }

  .chat-message__header {
    @apply mb-2 flex items-center gap-2 text-xs font-semibold text-whatsapp-ink-soft;
  }

  .chat-message__reply {
    @apply mb-2 flex gap-2 rounded-lg border border-whatsapp-divider bg-whatsapp-surface px-3 py-2 text-xs text-whatsapp-ink-soft;
  }

  .chat-message__reply-bar {
    @apply h-full w-1 rounded-full bg-whatsapp-accent;
  }

  .chat-message__mention {
    @apply font-semibold text-whatsapp-accent;
  }

  .chat-message__meta {
    @apply mt-2 flex items-center justify-between gap-2 text-[11px] text-whatsapp-bubble-meta;
  }

  .chat-message__actions {
    @apply flex items-center gap-2;
  }

  .chat-reply-preview {
    @apply mb-3 flex items-start gap-2 rounded-xl border border-whatsapp-border bg-whatsapp-panel px-3 py-2 text-xs text-whatsapp-ink-soft;
    max-width: 100%;
    overflow: hidden;
  }

  .chat-reply-preview .chat-message__reply-bar {
    flex-shrink: 0;
  }

  .chat-reply-preview .chat-message__reply-text {
    flex: 1 1 auto;
    min-width: 0;
    display: block;
    overflow-wrap: anywhere;
    text-wrap: balance;
  }

  .chat-composer {
    @apply flex items-end gap-3 border-t border-whatsapp-divider bg-whatsapp-panel px-6 py-4;
    padding-bottom: calc(2rem + env(safe-area-inset-bottom));
    min-height: calc(90px + env(safe-area-inset-bottom));
  }

  .chat-composer__context {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto;
    align-items: end;
    gap: 1rem;
    width: 100%;
  }

  .chat-composer__field {
    @apply relative w-full;
  }

  .chat-composer__input {
    @apply w-full rounded-[24px] border border-transparent bg-whatsapp-surface px-4 py-3 text-base shadow-sm transition-colors focus:border-whatsapp-accent focus:outline-none;
    min-height: 48px;
    resize: none;
    line-height: 1.35;
  }

  .chat-composer__input::placeholder {
    color: color-mix(in srgb, var(--whatsapp-ink) 40%, transparent);
  }

  .chat-composer__actions {
    @apply flex items-center gap-3 rounded-full bg-white shadow-sm px-3 py-1;
    justify-self: end;
  }

  .chat-composer__limit {
    @apply flex items-center gap-2 rounded-full border border-whatsapp-divider bg-white px-3 py-1 text-xs font-semibold text-whatsapp-ink-soft;
  }

  .chat-composer__limit input {
    @apply w-20 rounded-md border border-whatsapp-divider bg-white/90 px-2 py-1 text-xs text-whatsapp-ink focus:border-whatsapp-accent focus:outline-none;
  }

  .chat-composer__limit-icon {
    display: none;
  }

  .chat-composer__limit-text {
    @apply uppercase tracking-wide;
  }

  @media (max-width: 860px) {
    .chat-shell {
      min-height: 100vh;
    }

    .chat-header {
      @apply sticky top-0 z-30 px-4 py-3;
      background-color: rgba(255, 255, 255, 0.94);
      backdrop-filter: blur(10px);
    }

    .chat-header__info {
      @apply gap-2;
    }

    .chat-header__title {
      @apply text-sm;
    }

    .chat-header__status {
      @apply text-[11px];
    }

    .chat-history {
      @apply px-3 py-4;
      padding-bottom: calc(5.5rem + env(safe-area-inset-bottom, 0px));
    }

    .chat-history__stack {
      @apply max-w-full;
    }

    .chat-message {
      @apply max-w-full px-3 py-2 text-[0.95rem];
      border-radius: 18px;
    }

    .chat-message__meta {
      @apply text-[10px];
    }

    .chat-composer {
      @apply sticky bottom-0 flex-col gap-3 border-t px-4 py-3;
      background-color: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(10px);
      padding-bottom: calc(0.75rem + env(safe-area-inset-bottom, 0px));
    }

    .chat-composer {
      display: block;
    }

    .chat-composer__context {
      display: block;
      width: 100%;
      gap: 0;
    }

    .chat-composer__field,
    .chat-composer__field>* {
      width: 100%;
      display: block;
    }

    .chat-composer__actions {
      display: flex;
      width: 100%;
      margin-top: 0.5rem;
      justify-content: space-between;
      background: transparent;
      box-shadow: none;
      padding: 0;
    }

    .chat-composer__input {
      @apply text-base min-h-[48px] px-4 py-3;
    }

    .chat-composer__limit {
      @apply w-auto border-transparent bg-transparent px-2 py-0;
      gap: 0.5rem;
    }

    .chat-composer__limit-icon {
      display: inline-flex;
      @apply h-4 w-4 text-whatsapp-ink-subtle;
    }

    .chat-composer__limit-text {
      @apply hidden;
    }

    .chat-composer__limit input {
      @apply w-16 border border-whatsapp-divider rounded-full text-center bg-white/90;
      height: 32px;
    }
  }

  @screen md {
    .chat-composer__actions {
      justify-self: flex-end;
    }
  }

  .chat-typing-indicator {
    @apply flex items-center gap-2 text-xs text-whatsapp-ink-soft;
  }

  .chat-typing-indicator__dots {
    @apply flex items-center gap-1;
  }

  .chat-typing-indicator__dots span {
    @apply inline-block h-1.5 w-1.5 rounded-full bg-whatsapp-ink-soft;
    animation: blink 1.4s ease-in-out infinite;
  }

  .chat-typing-indicator__dots span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .chat-typing-indicator__dots span:nth-child(3) {
    animation-delay: 0.4s;
  }

  .profile-panel {
    @apply flex flex-1 flex-col overflow-y-auto bg-whatsapp-panel px-8 py-6;
  }

  .profile-panel__header {
    @apply mb-6 flex items-center justify-between;
  }

  .profile-panel__section {
    @apply mb-8 rounded-2xl border border-whatsapp-divider bg-whatsapp-panel px-6 py-5 shadow-sm;
  }
}

@layer utilities {
  .text-whatsapp-ink {
    color: var(--whatsapp-ink);
  }

  .text-whatsapp-ink-soft {
    color: var(--whatsapp-ink-soft);
  }

  .text-whatsapp-ink-subtle {
    color: var(--whatsapp-ink-subtle);
  }

  .text-whatsapp-bubble-meta {
    color: var(--whatsapp-bubble-meta);
  }

  .text-whatsapp-accent-dark {
    color: var(--whatsapp-accent-dark);
  }

  .bg-whatsapp-surface {
    background-color: var(--whatsapp-surface);
  }

  .bg-whatsapp-panel {
    background-color: var(--whatsapp-panel);
  }

  .bg-whatsapp-panel-muted {
    background-color: var(--whatsapp-panel-muted);
  }

  .bg-whatsapp-accent {
    background-color: var(--whatsapp-accent);
  }

  .bg-whatsapp-accent-soft {
    background-color: var(--whatsapp-accent-soft);
  }

  .bg-whatsapp-accent-soft\/70 {
    background-color: rgba(217, 253, 211, 0.7);
  }

  .bg-whatsapp-accent\/10 {
    background-color: rgba(0, 168, 132, 0.1);
  }

  .hover\:bg-whatsapp-accent\/10:hover {
    background-color: rgba(0, 168, 132, 0.1);
  }

  .hover\:bg-whatsapp-panel-muted:hover {
    background-color: var(--whatsapp-panel-muted);
  }

  .bg-whatsapp-bubble-incoming {
    background-color: var(--whatsapp-bubble-incoming);
  }

  .bg-whatsapp-bubble-outgoing {
    background-color: var(--whatsapp-bubble-outgoing);
  }

  .bg-whatsapp-bubble-system {
    background-color: var(--whatsapp-bubble-system);
  }

  .border-whatsapp-border {
    border-color: var(--whatsapp-border);
  }

  .border-whatsapp-divider {
    border-color: var(--whatsapp-divider);
  }

  .border-whatsapp-accent {
    border-color: var(--whatsapp-accent);
  }

  .ring-whatsapp-accent\/40 {
    --tw-ring-color: rgba(0, 168, 132, 0.4);
  }
}

:root {
  --chat-pattern: radial-gradient(circle at 1px 1px, rgba(17, 27, 33, 0.06) 1px, transparent 0);
}